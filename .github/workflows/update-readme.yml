name: Update README

on:
  # æ¯å¤© UTC æ—¶é—´ 12:00 è‡ªåŠ¨è¿è¡Œ
  schedule:
    - cron: '0 12 * * *'
  
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
  
  # å½“å·¥ä½œæµæ–‡ä»¶æ›´æ”¹æ—¶è¿è¡Œ
  push:
    paths:
      - '.github/workflows/update-readme.yml'
      - 'README.md'

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Setup Git
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global pull.rebase false
          
      - name: Update README Date
        run: |
          # è·å–å½“å‰æ—¥æœŸå’Œæ—¶é—´
          CURRENT_DATE=$(date '+%Y-%m-%d %H:%M:%S UTC')
          CURRENT_YEAR=$(date '+%Y')
          
          # å¤‡ä»½åŸå§‹ README
          cp README.md README.md.backup
          
          # æ›´æ–°æ—¥æœŸå ä½ç¬¦
          sed -i "s/{{ UPDATE_DATE }}/$CURRENT_DATE/g" README.md
          sed -i "s/{{ CURRENT_YEAR }}/$CURRENT_YEAR/g" README.md
          
          # æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ”¹
          if ! diff -q README.md README.md.backup > /dev/null; then
            echo "ğŸ“… Updating README with new date: $CURRENT_DATE"
            
            # æäº¤æ›´æ”¹
            git add README.md
            git commit -m "ğŸ“… Auto-update README: $CURRENT_DATE"
            git push
            echo "âœ… README updated successfully"
          else
            echo "ğŸ“„ No changes to README"
          fi
          
          # æ¸…ç†å¤‡ä»½æ–‡ä»¶
          rm README.md.backup
          
      - name: Update Statistics Cache
        run: |
          # æ¸…ç† GitHub Stats ç¼“å­˜
          echo "ğŸ”„ Clearing GitHub Stats cache..."
          curl -s "https://github-readme-stats.vercel.app/api?username=${{ github.repository_owner }}&cache_seconds=$(date +%s)" > /dev/null
          curl -s "https://github-readme-stats.vercel.app/api/top-langs/?username=${{ github.repository_owner }}&cache_seconds=$(date +%s)" > /dev/null
          
      - name: Send Success Notification
        if: success()
        run: |
          echo "ğŸ‰ README update workflow completed successfully!"
          echo "ğŸ“… Last updated: $(date '+%Y-%m-%d %H:%M:%S UTC')"
          
      - name: Send Failure Notification
        if: failure()
        run: |
          echo "âŒ README update workflow failed!"
          echo "Please check the workflow logs for details"
